# 极客学院 重构课程

## Todolist

* 第一个视频待改：
  * 为什么要采用面向对象的设计方式可以解释一下
  * 第一遍还是要先测试一下对象可以创建，第一步步子不会太大
  * 好像口头禅和重复有点多（怎么样…对吧…那…复读模式…）
* 。。。

## TDD营已经传达的知识点

* TDD定律：没有失败的测试不写代码
* TDD定律：只写刚好能够使测试通过的代码
* TDD的节奏：开始实现之前，一定要运行一下测试使其失败
* TDD的步骤：先写测试、再写断言，创建类使编译通过、简单实现 
* 刻意练习：贯穿在课程中

## 重构训练营要传达的知识点

* [x] TDD、先写测试再写代码、没有失败测试不写代码 —— 导向TDD课
* 没有测试绝不重构
  * 安全网都没有 —— 对应“补安全网的技能”
  * [1] 重构的功能没有测试 —— 对应“补测试的技能”
* [1] 每写一行代码都要运行测试 —— 对应“快捷键”和“运行测试的技能”
* [1] 重构十六字真言 —— 对应在每个步骤的
* [1] 指出重构必然要求TDD —— 重构要有测试，靠谱的测试只能通过TDD得到
* [1] 快捷键 —— 可以贯穿在课程里
* 测试失败直接回滚 —— 对应原子提交
* 你通过什么方式来判断一段代码是否需要被重构 —— 坏味道
  * 重命名/不达意的命名/注释：
  * 不容忍重复代码：否则每处修改的话要改许多地方
  * 肢解长函数
  * 过长的消息链/基本类型偏执/数据泥团/依恋情结 -> 面向对象
* 好的代码大致上是否有一些共同的特征 —— 讲不讲 
* 从最简单的开始重构
* 从坏味道开始（第3章） —— 查找重构手法（第6章始） —— 严格遵循重构手法（十六字真言） 

* 重构其实是消除if语句的过程
  * 重复部分是字符串/常量：抽取成常变量`const`/`enum`
  * 重复部分是查表过程：把重复收缩到一个用处处理数据查询模块，如此封装了内部数据结构。问题复杂度转化到“表格数据的初始化/更新”上
  * 重复部分是多个方法中对某个字段的重复判断：变成子类，共同的方法放到父类中，不同的部分通过子类覆写。问题复杂度转化到“类型的创建”上。这种方式要求不同的子类是可穷尽的
  * 

## 课程设计

* 过滤一下现有的练习
* 四个课程分别设计些什么练习点？需要总结一下刻意练习点，然后揉碎到课程中去
* 如何使课程设计与行业潮流、平台卖点对应到一块去？这个需要考虑
  * 卖点1：手把手演示重构的全过程
  * 卖点2：以练为主
  * 卖点3：学习方式是否高效、内容设计是否合理、配套资料是否完备、项目难度设置是否合理、学习周期设计是否合理
* [x] 十六字箴言最后写完课程记得全部（或者在最前面）credits给健总
* [x] 第一个练习是不是需要用货币练习切入一下？—— 是

四个课程的设计，难度依次渐进：

* [x] 第一个案例：
  * 课程会帮忙补齐所有测试，不需要学员做补充“安全网测试”的事；
  * 不假定学员掌握TDD，可以让学员试着抄单元测试，了解其编写方法与运行方式；
  * 主要是让学员对重构有个直观的印象，可以安排包括“环境准备”、“运行测试”、“重构节奏”、“基本手法和快捷键”等内容；
  * 强调重构心法、强化重构手法和步骤
  * 简单介绍一两个入门的手法：重命名函数、提炼函数
* 第二个案例：难度应该介于单位转换和镶金玫瑰之间
  * 可以包含“补充安全网测试”的内容
  * 开始介绍坏味道
  * 介绍一些更加常见且难度更大一点点的重构，比如添加参数等
* 第三个案例：考虑采用镶金玫瑰
  * 介绍“不理解结构”、仅凭借结构处理的重构法
  * 包括“面向对象”、“子类化”、“if-反转”等中等难度的重构
* 第四个案例：我想弄个更贴近实战的例子，比如有mock的，分层的，数据库，网络请求的。三方依赖的都可以不用真实的，但是是否可以演示一下企业级代码的重构方式？

经验
---

* 写课程的口吻可以更讲故事一点
* 用不同的分支，保证学员可以一键切换到baseline
* 引导学员思考TDD、重构过程的问题 —— 相当于帮同学弄一个todolist，把tasking帮他做了
  * 任务其实是你先做道题出来，再把你的思路变成tasking的过程
* 是否仅仅只有重构？是否可以添加新的需求？

## 刻意练习点

* 补安全网测试
  * 直接给输入，得到系统当下的运行结果，copy一下，作为baseline的基线测试
  * 涉及数据库，过程中有不稳定输入怎么办？
  * 涉及网络，不符合单元测试的原则怎么办？—— 没关系，安全网测试体现的是对中间过程的设计，待重构完成后，可以再把涉及副作用的测试
* 最基本的重构：
  * 重命名 —— 刻意练习及快捷键
  * 提炼方法 —— 刻意练习及快捷键
  * 添加参数  
* 结构相关的重构：不需要动脑筋
  * 反转if逻辑 + 提前返回 简化结构
  * 循环代码 用函数式代码替代掉
* 面向对象：
  * 函数搬移到类 —— 如何每一小步地前进
* 子类化
  * 用多态取代条件语句

## 参考资料

* https://kata-log.rocks/refactoring
* 书籍：重构、对象练功操、修改代码的艺术
* 看一下TDD课程已经涉及的东西和没涉及的东西

